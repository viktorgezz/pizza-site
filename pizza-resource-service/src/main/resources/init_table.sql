CREATE TABLE IF NOT EXISTS Restaurant (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    address VARCHAR(255) NOT NULL,
    status status_restaurant NOT NULL DEFAULT 'OPEN'
);

CREATE TABLE IF NOT EXISTS _user (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    enabled BOOLEAN NOT NULL DEFAULT true,
    role role NOT NULL DEFAULT 'USER',
    email VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS Employee (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    job_description VARCHAR(255) NOT NULL,
    id_user BIGINT NOT NULL UNIQUE REFERENCES _User(id),
    id_restaurant BIGINT NOT NULL REFERENCES Restaurant(id)
);

CREATE TABLE IF NOT EXISTS Customer (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    address VARCHAR(255) NOT NULL,
    phone VARCHAR(50) NOT NULL UNIQUE,
    user_id BIGINT NOT NULL UNIQUE REFERENCES _User(id)
);

CREATE TABLE IF NOT EXISTS Menu_item (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    id_restaurant BIGINT NOT NULL REFERENCES Restaurant(id),
    title VARCHAR(60) NOT NULL,
    price NUMERIC(10, 2) NOT NULL CHECK (price > 0),
    description VARCHAR(255) NOT NULL,
    image_url VARCHAR(1024) NOT NULL
);

CREATE TABLE IF NOT EXISTS Ingredient (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    title VARCHAR(60) NOT NULL,
    quantity NUMERIC(11, 3) NOT NULL CHECK (quantity > 0),
    measure measure NOT NULL
);

CREATE TABLE IF NOT EXISTS Menu_item_ingredient (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    id_ingredient BIGINT NOT NULL REFERENCES Ingredient(id),
    id_menu_item BIGINT NOT NULL REFERENCES Menu_item(id),
    UNIQUE (id_ingredient, id_menu_item)
);


CREATE TABLE IF NOT EXISTS Courier (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    phone VARCHAR(50) NOT NULL UNIQUE,
    status status_courier NOT NULL DEFAULT 'FREE'
);

CREATE TABLE IF NOT EXISTS _Order (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, 
    id_customer BIGINT NOT NULL REFERENCES Customer(id),
    id_restaurant BIGINT NOT NULL REFERENCES Restaurant(id),
    id_courier BIGINT REFERENCES Courier(id),
    status status_order NOT NULL DEFAULT 'PENDING',
    order_type type_order NOT NULL,
    date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS Order_item (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    id_order BIGINT NOT NULL REFERENCES _Order(id),
    id_menu_item BIGINT NOT NULL REFERENCES Menu_item(id),
    quantity INTEGER NOT NULL CHECK (quantity >= 1 AND quantity <= 10),
    price NUMERIC(10, 2) NOT NULL CHECK (price > 0),
    UNIQUE (id_order, id_menu_item)
);



